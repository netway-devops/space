/*
 * noVNC: HTML5 VNC client
 * Copyright (C) 2012 Joel Martin
 * Licensed under MPL 2.0 (see LICENSE.txt)
 *
 * See README.md for usage and integration instructions.
 */
"use strict";window.onscriptsload=function(){UI.load()},Util.load_scripts(["webutil.js","base64.js","websock.js","des.js","input.js","display.js","jsunzip.js","rfb.js"]);var UI={rfb_state:"loaded",settingsOpen:!1,connSettingsOpen:!1,clipboardOpen:!1,keyboardVisible:!1,load:function(e){WebUtil.initSettings(UI.start,e)},start:function(e){var t="",n,r,i,s,o;r=WebUtil.selectStylesheet(),i=WebUtil.getStylesheets();for(n=0;n<i.length;n+=1)UI.addOption($D("noVNC_stylesheet"),i[n].title,i[n].title);s=["error","warn","info","debug"];for(n=0;n<s.length;n+=1)UI.addOption($D("noVNC_logging"),s[n],s[n]);UI.initSetting("logging","warn"),WebUtil.init_logging(UI.getSetting("logging")),UI.initSetting("stylesheet","default"),WebUtil.selectStylesheet(null),WebUtil.selectStylesheet(UI.getSetting("stylesheet")),o=window.location.port,o||(window.location.protocol.substring(0,5)=="https"?o=443:window.location.protocol.substring(0,4)=="http"&&(o=80)),UI.initSetting("host",window.location.hostname),UI.initSetting("port",o),UI.initSetting("password",""),UI.initSetting("encrypt",window.location.protocol==="https:"),UI.initSetting("true_color",!0),UI.initSetting("cursor",!1),UI.initSetting("shared",!0),UI.initSetting("view_only",!1),UI.initSetting("connectTimeout",2),UI.initSetting("path","websockify"),UI.initSetting("repeaterID",""),UI.rfb=RFB({target:$D("noVNC_canvas"),onUpdateState:UI.updateState,onClipboard:UI.clipReceive}),UI.updateVisualState(),"ontouchstart"in document.documentElement?($D("noVNC_mobile_buttons").style.display="inline",UI.setMouseButton(),setTimeout(function(){window.scrollTo(0,1)},100),UI.forceSetting("clip",!0),$D("noVNC_clip").disabled=!0):UI.initSetting("clip",!1),navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i),UI.setBarPosition(),$D("noVNC_host").focus(),UI.setViewClip(),Util.addEvent(window,"resize",UI.setViewClip),Util.addEvent(window,"beforeunload",function(){if(UI.rfb_state==="normal")return"You are currently connected."}),location.host==="kanaka.github.com"?$D("noVNC_description").style.display="block":UI.toggleConnectPanel(),UI.addMouseHandlers(),typeof e=="function"&&e(UI.rfb)},addMouseHandlers:function(){$D("noVNC_view_drag_button").onclick=UI.setViewDrag,$D("noVNC_mouse_button0").onclick=function(){UI.setMouseButton(1)},$D("noVNC_mouse_button1").onclick=function(){UI.setMouseButton(2)},$D("noVNC_mouse_button2").onclick=function(){UI.setMouseButton(4)},$D("noVNC_mouse_button4").onclick=function(){UI.setMouseButton(0)},$D("showKeyboard").onclick=UI.showKeyboard,$D("keyboardinput").onblur=UI.keyInputBlur,$D("sendCtrlAltDelButton").onclick=UI.sendCtrlAltDel,$D("clipboardButton").onclick=UI.toggleClipboardPanel,$D("settingsButton").onclick=UI.toggleSettingsPanel,$D("connectButton").onclick=UI.toggleConnectPanel,$D("disconnectButton").onclick=UI.disconnect,$D("descriptionButton").onclick=UI.toggleConnectPanel,$D("noVNC_clipboard_text").onfocus=UI.displayBlur,$D("noVNC_clipboard_text").onblur=UI.displayFocus,$D("noVNC_clipboard_text").onchange=UI.clipSend,$D("noVNC_clipboard_clear_button").onclick=UI.clipClear,$D("noVNC_settings_menu").onmouseover=UI.displayBlur,$D("noVNC_settings_menu").onmouseover=UI.displayFocus,$D("noVNC_apply").onclick=UI.settingsApply,$D("noVNC_connect_button").onclick=UI.connect},getSetting:function(e){var t,n=$D("noVNC_"+e);return t=WebUtil.readSetting(e),t!==null&&n.type==="checkbox"&&(t.toString().toLowerCase()in{0:1,no:1,"false":1}?t=!1:t=!0),t},updateSetting:function(e,t){var n,r=$D("noVNC_"+e);typeof t!="undefined"&&WebUtil.writeSetting(e,t),t=UI.getSetting(e);if(r.type==="checkbox")r.checked=t;else if(typeof r.options!="undefined"){for(n=0;n<r.options.length;n+=1)if(r.options[n].value===t){r.selectedIndex=n;break}}else t===null&&(t=""),r.value=t},saveSetting:function(e){var t,n=$D("noVNC_"+e);return n.type==="checkbox"?t=n.checked:typeof n.options!="undefined"?t=n.options[n.selectedIndex].value:t=n.value,WebUtil.writeSetting(e,t),t},initSetting:function(e,t){var n;return n=WebUtil.getQueryVar(e),n===null&&(n=WebUtil.readSetting(e,t)),UI.updateSetting(e,n),n},forceSetting:function(e,t){return UI.updateSetting(e,t),t},toggleClipboardPanel:function(){$D("noVNC_description").style.display="none",UI.settingsOpen===!0&&(UI.settingsApply(),UI.closeSettingsMenu()),UI.connSettingsOpen===!0&&UI.toggleConnectPanel(),UI.clipboardOpen===!0?($D("noVNC_clipboard").style.display="none",$D("clipboardButton").className="noVNC_status_button",UI.clipboardOpen=!1):($D("noVNC_clipboard").style.display="block",$D("clipboardButton").className="noVNC_status_button_selected",UI.clipboardOpen=!0)},toggleConnectPanel:function(){$D("noVNC_description").style.display="none",UI.settingsOpen===!0&&(UI.settingsApply(),UI.closeSettingsMenu(),$D("connectButton").className="noVNC_status_button"),UI.clipboardOpen===!0&&UI.toggleClipboardPanel(),UI.connSettingsOpen===!0?($D("noVNC_controls").style.display="none",$D("connectButton").className="noVNC_status_button",UI.connSettingsOpen=!1,UI.saveSetting("host"),UI.saveSetting("port")):($D("noVNC_controls").style.display="block",$D("connectButton").className="noVNC_status_button_selected",UI.connSettingsOpen=!0,$D("noVNC_host").focus())},toggleSettingsPanel:function(){$D("noVNC_description").style.display="none",UI.settingsOpen?(UI.settingsApply(),UI.closeSettingsMenu()):(UI.updateSetting("encrypt"),UI.updateSetting("true_color"),UI.rfb.get_display().get_cursor_uri()?UI.updateSetting("cursor"):(UI.updateSetting("cursor",!1),$D("noVNC_cursor").disabled=!0),UI.updateSetting("clip"),UI.updateSetting("shared"),UI.updateSetting("view_only"),UI.updateSetting("connectTimeout"),UI.updateSetting("path"),UI.updateSetting("repeaterID"),UI.updateSetting("stylesheet"),UI.updateSetting("logging"),UI.openSettingsMenu())},openSettingsMenu:function(){$D("noVNC_description").style.display="none",UI.clipboardOpen===!0&&UI.toggleClipboardPanel(),UI.connSettingsOpen===!0&&UI.toggleConnectPanel(),$D("noVNC_settings").style.display="block",$D("settingsButton").className="noVNC_status_button_selected",UI.settingsOpen=!0},closeSettingsMenu:function(){$D("noVNC_settings").style.display="none",$D("settingsButton").className="noVNC_status_button",UI.settingsOpen=!1},settingsApply:function(){UI.saveSetting("encrypt"),UI.saveSetting("true_color"),UI.rfb.get_display().get_cursor_uri()&&UI.saveSetting("cursor"),UI.saveSetting("clip"),UI.saveSetting("shared"),UI.saveSetting("view_only"),UI.saveSetting("connectTimeout"),UI.saveSetting("path"),UI.saveSetting("repeaterID"),UI.saveSetting("stylesheet"),UI.saveSetting("logging"),WebUtil.selectStylesheet(UI.getSetting("stylesheet")),WebUtil.init_logging(UI.getSetting("logging")),UI.setViewClip(),UI.setViewDrag(UI.rfb.get_viewportDrag())},setPassword:function(){return UI.rfb.sendPassword($D("noVNC_password").value),$D("noVNC_connect_button").value="Connect",$D("noVNC_connect_button").onclick=UI.Connect,UI.toggleConnectPanel(),!1},sendCtrlAltDel:function(){UI.rfb.sendCtrlAltDel()},setMouseButton:function(e){var t,n=[0,1,2,4],r;typeof e=="undefined"&&(e=-1),UI.rfb&&UI.rfb.get_mouse().set_touchButton(e);for(t=0;t<n.length;t++)r=$D("noVNC_mouse_button"+n[t]),n[t]===e?r.style.display="":r.style.display="none"},updateState:function(e,t,n,r){var i,s,o,u,a,f,l;UI.rfb_state=t,i=$D("noVNC_status"),s=$D("noVNC_status_bar");switch(t){case"failed":case"fatal":l="noVNC_status_error";break;case"normal":l="noVNC_status_normal";break;case"disconnected":$D("noVNC_logo").style.display="block";case"loaded":l="noVNC_status_normal";break;case"password":UI.toggleConnectPanel(),$D("noVNC_connect_button").value="Send Password",$D("noVNC_connect_button").onclick=UI.setPassword,$D("noVNC_password").focus(),l="noVNC_status_warn";break;default:l="noVNC_status_warn"}typeof r!="undefined"&&(i.setAttribute("class",l),s.setAttribute("class",l),i.innerHTML=r),UI.updateVisualState()},updateVisualState:function(){var e=UI.rfb_state==="normal"?!0:!1;$D("noVNC_encrypt").disabled=e,$D("noVNC_true_color").disabled=e,UI.rfb&&UI.rfb.get_display()&&UI.rfb.get_display().get_cursor_uri()?$D("noVNC_cursor").disabled=e:(UI.updateSetting("cursor",!1),$D("noVNC_cursor").disabled=!0),$D("noVNC_shared").disabled=e,$D("noVNC_view_only").disabled=e,$D("noVNC_connectTimeout").disabled=e,$D("noVNC_path").disabled=e,$D("noVNC_repeaterID").disabled=e,e?(UI.setViewClip(),UI.setMouseButton(1),$D("clipboardButton").style.display="inline",$D("showKeyboard").style.display="inline",$D("sendCtrlAltDelButton").style.display="inline"):(UI.setMouseButton(),$D("clipboardButton").style.display="none",$D("showKeyboard").style.display="none",$D("sendCtrlAltDelButton").style.display="none"),UI.setViewDrag(!1);switch(UI.rfb_state){case"fatal":case"failed":case"loaded":case"disconnected":$D("connectButton").style.display="",$D("disconnectButton").style.display="none";break;default:$D("connectButton").style.display="none",$D("disconnectButton").style.display=""}},clipReceive:function(e,t){Util.Debug(">> UI.clipReceive: "+t.substr(0,40)+"..."),$D("noVNC_clipboard_text").value=t,Util.Debug("<< UI.clipReceive")},connect:function(){var e,t,n,r;UI.closeSettingsMenu(),UI.toggleConnectPanel(),e=$D("noVNC_host").value,t=$D("noVNC_port").value,n=$D("noVNC_password").value,r=$D("noVNC_path").value;if(!e||!t)throw"Must set host and port";UI.rfb.set_encrypt(UI.getSetting("encrypt")),UI.rfb.set_true_color(UI.getSetting("true_color")),UI.rfb.set_local_cursor(UI.getSetting("cursor")),UI.rfb.set_shared(UI.getSetting("shared")),UI.rfb.set_view_only(UI.getSetting("view_only")),UI.rfb.set_connectTimeout(UI.getSetting("connectTimeout")),UI.rfb.set_repeaterID(UI.getSetting("repeaterID")),UI.rfb.connect(e,t,n,r),setTimeout(UI.setBarPosition,100),$D("noVNC_logo").style.display="none"},disconnect:function(){UI.closeSettingsMenu(),UI.rfb.disconnect(),$D("noVNC_logo").style.display="block",UI.connSettingsOpen=!1,UI.toggleConnectPanel()},displayBlur:function(){UI.rfb.get_keyboard().set_focused(!1),UI.rfb.get_mouse().set_focused(!1)},displayFocus:function(){UI.rfb.get_keyboard().set_focused(!0),UI.rfb.get_mouse().set_focused(!0)},clipClear:function(){$D("noVNC_clipboard_text").value="",UI.rfb.clipboardPasteFrom("")},clipSend:function(){var e=$D("noVNC_clipboard_text").value;Util.Debug(">> UI.clipSend: "+e.substr(0,40)+"..."),UI.rfb.clipboardPasteFrom(e),Util.Debug("<< UI.clipSend")},setViewClip:function(e){var t,n,r,i,s;if(!UI.rfb)return;t=UI.rfb.get_display(),n=t.get_viewport(),typeof e!="boolean"&&(e=UI.getSetting("clip")),e&&!n?UI.updateSetting("clip",!0):!e&&n&&(UI.updateSetting("clip",!1),t.set_viewport(!1),$D("noVNC_canvas").style.position="static",t.viewportChange()),UI.getSetting("clip")&&($D("noVNC_canvas").style.position="absolute",r=Util.getPosition($D("noVNC_canvas")),i=window.innerWidth-r.x,s=window.innerHeight-r.y,t.set_viewport(!0),t.viewportChange(0,0,i,s))},setViewDrag:function(e){var t=$D("noVNC_view_drag_button");if(!UI.rfb)return;UI.rfb_state==="normal"&&UI.rfb.get_display().get_viewport()?t.style.display="inline":t.style.display="none";if(typeof e=="undefined"||typeof e=="object")e=!UI.rfb.get_viewportDrag();e?(t.className="noVNC_status_button_selected",UI.rfb.set_viewportDrag(!0)):(t.className="noVNC_status_button",UI.rfb.set_viewportDrag(!1))},showKeyboard:function(){UI.keyboardVisible===!1?($D("keyboardinput").focus(),UI.keyboardVisible=!0,$D("showKeyboard").className="noVNC_status_button_selected"):UI.keyboardVisible===!0&&($D("keyboardinput").blur(),$D("showKeyboard").className="noVNC_status_button",UI.keyboardVisible=!1)},keyInputBlur:function(){$D("showKeyboard").className="noVNC_status_button",setTimeout(function(){UI.setKeyboard()},100)},setKeyboard:function(){UI.keyboardVisible=!1},setOnscroll:function(){window.onscroll=function(){UI.setBarPosition()}},setResize:function(){window.onResize=function(){UI.setBarPosition()}},addOption:function(e,t,n){var r=document.createElement("OPTION");r.text=t,r.value=n,e.options.add(r)},setBarPosition:function(){$D("noVNC-control-bar").style.top=window.pageYOffset+"px",$D("noVNC_mobile_buttons").style.left=window.pageXOffset+"px";var e=$D("noVNC_screen").style.offsetWidth;$D("noVNC-control-bar").style.width=e+"px"}};