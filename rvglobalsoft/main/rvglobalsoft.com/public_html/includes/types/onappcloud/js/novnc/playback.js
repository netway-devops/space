/*
 * noVNC: HTML5 VNC client
 * Copyright (C) 2012 Joel Martin
 * Licensed under MPL 2.0 (see LICENSE.txt)
 */
"use strict";var rfb,mode,test_state,frame_idx,frame_length,iteration,iterations,istart_time,send_array,next_iteration,queue_next_packet,do_packet;send_array=function(e){},next_iteration=function(){iteration===0?(frame_length=VNC_frame_data.length,test_state="running"):rfb.disconnect();if(test_state!=="running")return;iteration+=1;if(iteration>iterations){finish();return}frame_idx=0,istart_time=(new Date).getTime(),rfb.connect("test",0,"bogus"),queue_next_packet()},queue_next_packet=function(){var e,t,n,r;if(test_state!=="running")return;e=VNC_frame_data[frame_idx];while(frame_idx<frame_length&&e.charAt(0)==="}")frame_idx+=1,e=VNC_frame_data[frame_idx];if(e==="EOF"){Util.Debug("Finished, found EOF"),next_iteration();return}if(frame_idx>=frame_length){Util.Debug("Finished, no more frames"),next_iteration();return}mode==="realtime"?(t=e.slice(1,e.indexOf("{",1)),n=(new Date).getTime()-istart_time,r=t-n,r<1&&(r=1),setTimeout(do_packet,r)):setTimeout(do_packet,1)};var bytes_processed=0;do_packet=function(){var e=VNC_frame_data[frame_idx],t=e.indexOf("{",1)+1;bytes_processed+=e.length-t;if(VNC_frame_encoding==="binary"){var n=new Uint8Array(e.length-t);for(var r=0;r<e.length-t;r++)n[r]=e.charCodeAt(t+r);rfb.recv_message({data:n})}else rfb.recv_message({data:e.slice(t)});frame_idx+=1,queue_next_packet()};