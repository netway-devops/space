<?php

/**
 * 
 * Hostbill API
 * 
 * http://api.hostbillapp.com/apps/getServerDetails/
 * http://wiki.hostbillapp.com/index.php?title=API:HBWrapper
 * 
 */

// Load Hostbill Wrapper
include_once("class.hbwrapper.php");

// Load Hostbill Common
include_once(APPDIR_MODULES . "Other/netway_common/include/class.hostbill.common.php");

// Load Hostbill Dao
include_once(APPDIR_MODULES . "Other/netway_common/include/class.hostbill.dao.php");

class HostbillApi {
    
    //protected $params;
    
    protected $moduleName = "netway common";
    
    /**
     * 
     * Enter description here ...
     */
    public function __construct() {}
    
    /**
     * Returns a singleton HostbillApi instance.
     *
     * @author Puttipong Pengprakhon <puttipong@rvglobalsoft.com>
     * @param bool $autoload
     * @return obj
     * 
     */
     public function &singleton($autoload=false) {
        static $instance;
        // If the instance is not there, create one
        if (!isset($instance) || $autoload) {
            $class = __CLASS__;
            $instance = new $class();
        }
        return $instance;
    }


    /**
     * 
     * Enter description here ...
     * @param $aParams
     * 
     * HostbillApi::singleton()->sendmail(array(
     *      'recipient' => 'domain@tickets.netway.co.th',
     *      'from' => 'puttipong@rvglobalsoft.com',
     *      'subject' => 'มีการเปลี่ยนแปลงข้อมูล Nameservers',
     *      'message' => 'message',
     * ))
     */
    public function sendmail($aParams=array()) {
    	
    	$NEWLINE = "\n";
    	
        $recipient = $aParams['recipient'];
        $from = $aParams['from'];
        $subject = $aParams['subject'];
        $message = $aParams['message'];
        
        $url = "http://netway.co.th"; // Generated By Netway.co.th
        $charset = 'utf-8';
        $boundary = "===============" . HostbillApi::singleton()->randId(19) . "==";
    	        
        $contentPlain = <<<EOF
$message
  
--=20
This message is automatically generated by {$url}.
EOF;

        /*
        $contentHtml = <<<EOF
<pre class="moz-signature" cols="72">--
This message is automatically generated by <a class="moz-txt-link-freetext" href="{$url}">{$url}</a>.
</pre>
EOF;
        */

        
        $headers  = "MIME-Version: 1.0" . $NEWLINE;        
        $headers .= "From: " . $from . $NEWLINE;
        
        $headers .= "X-Mailer: DT Formmail 5.0" . $NEWLINE;
        $headers .= "Content-Type: multipart/mixed;" . "\tboundary=\"{$boundary}\"" . $NEWLINE;

        $message  = "This is a multi-part message in MIME format." . $NEWLINE;
        $message .= "--{$boundary}" . $NEWLINE;
        $message .= "Content-Type: multipart/alternative;" . $NEWLINE;
        $message .= "This is a multi-part message in MIME format." . $NEWLINE;
        
        $message .= "--{$boundary}" . $NEWLINE; 
        $message .= "Content-Type: text/plain;" . $NEWLINE . "\tcharset=\"{$charset}\" format=flowed" . $NEWLINE;
        $message .= "Content-Transfer-Encoding: quoted-printable" . $NEWLINE . $NEWLINE;
        $message .= "{$contentPlain}" . $NEWLINE . $NEWLINE;

        /*
        $message .= $NEWLINE . "--{$boundary}" . $NEWLINE;
        $message .= "Content-Type: text/html; charset=\"{$charset}\"" . $NEWLINE;
        $message .= "Content-Transfer-Encoding: 8bit" . $NEWLINE . $NEWLINE;
        $message .=  "{$contentHtml}" . $NEWLINE . $NEWLINE;
        */
        
        $message .= $NEWLINE . "--{$boundary}--" . $NEWLINE;
        
        
        if (mail($recipient, $subject, $message, $headers)) {
        } else {
        	// Not Send Mail.
        }
    	
    	return true;
    }
    
    /**
     * 
     * Enter description here ...
     * @param $numbit
     */
    public function randId($numbit=0) {
        $result ='';
        for ($i=0; $i<$numbit;$i++) {
            $result .= rand(0,9);
        }   
        return $result;
    }
    
    
}